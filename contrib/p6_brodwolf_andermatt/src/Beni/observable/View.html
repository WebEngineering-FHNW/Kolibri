<!DOCTYPE html>
<html>
<head>
    <title>View</title>
    <script src="../../Pascal/playground.js"></script>

    <script src="../listMap/listMap.js"></script>
    <script src="observable.js"></script>
    <link rel="stylesheet" href="../style.css">

</head>
<body>


<input id="name" type="text">
<div id="label"></div>
<div id="sizes"></div>

<script>
    const getElement  = id => document.getElementById(id); // maybe impl for safety
    const getElements = (...id) => id.map(e => getElement(e))

    const onInputListener  = (observable, input) => input.oninput = _ => observable(setValue)(input.value) // maybe impl for safety
    const onInputListeners = (observable, ...inputs) => inputs.map(input => onInputListener(observable, input))

    const [nameInput, label, sizes] = getElements("name", "label", "sizes")

    // "let" wenn soll zus채tzliche Listener hinzugef체gt werden,
    // ansonsten, wenn immutable mit "const" vor ver채nderung sch체tzen
    const inputObservable = InitObservable
                (addListener)(val => label.innerText = val)
                (addListener)(val => sizes.innerText = val.length)

    onInputListener(inputObservable, nameInput)

</script>
<hr>

<style>

    body {
        font-family: Consolas, 'courier new'
    }

    .padding-large {
        padding: 20px;
        background-color: #f1f1f1;
        overflow: hidden;
    }


    #resultColor {
        height: 200px;
    }

    .slider {
        -webkit-appearance: none;
        height: 15px;
        border-radius: 5px;
        background: #d3d3d3;
        outline: none;
        opacity: 0.7;
        -webkit-transition: .2s;
        transition: opacity .2s;
    }

</style>
<div class="overflow-hidden">
    <div class="padding-large w-full">
        <h2>RGB Calculator</h2>
        <br>
        <div class="row">
            <div class="col w-50" style="background-color: rgb(0, 0, 0);" id="resultColor"></div>
            <div class="col w-10">&nbsp;</div>
            <div class="col w-40">
                <div class="">
                    <input id="rgbValue" type="text" class="pt-3 pb-3">
                    <br>
                    <br>
                    <div id="hex" class="pt-3 pb-3"></div>
                    <br>
                    <div id="hsl" class="pt-3 pb-3">hsl(75, 100%, 34%)</div>
                </div>
            </div>
        </div>
        <br>
        <div class="row w-full">
            <div class="col ">R:</div>
            <input type="number" id="inputR" value="0" class="col w-10 mx-5">
            <input type="range" min="0" max="255" value="0" class="slider col w-80" id="rangeR">
        </div>
        <br>
        <div class="row w-full">
            <div class="col ">G:</div>
            <input type="number" id="inputG" value="0" class="col w-10 mx-5">
            <input type="range" min="0" max="255" value="0" class="slider col w-80" id="rangeG">
        </div>
        <br>
        <div class="row w-full">
            <div class="col ">B:</div>
            <input type="number" id="inputB" value="0" class="col w-10 mx-5">
            <input type="range" min="0" max="255" value="0" class="slider col w-80" id="rangeB">
        </div>
    </div>
</div>

<button onclick="changeValue()">Press my</button>
<script>
    const toRGBString = (r,g,b) => 'rgb(' + r + ',' + g+ ',' + b + ')'

    const toHexString = (r,g,b) => "#" + toHex(r) + toHex(g) + toHex(b)

    const toHex = n => {
        if (n === undefined) n = 0
        let hex = n.toString(16);
        if (hex.length === 1) {
            hex = "0" + hex;
        }
        return hex;
    }


    const [resultColor, rgbValue, hex, hsl] = getElements("resultColor", "rgbValue", "hex", "hsl")
    const [inputR, inputG, inputB]          = getElements("inputR", "inputG", "inputB")
    const [rangeR, rangeG, rangeB]          = getElements("rangeR", "rangeG", "rangeB")

    const setElementValue = valuable => x => valuable.value = x




    let obsR = null;

    let obsRKeys = []
    obsR = InitObservable
                    (addListener)(r => setElementValue( obsR )(r))
                    (addListener)(r => setElementValue( inputR )(r))
                    (addListener)(r => setElementValue( rangeR )(r))
                    (addListener)(r => resultColor.style.backgroundColor = toRGBString(r, obsG.value, obsB.value))
                    (addListener)(r => rgbValue.value                    = toRGBString(r, obsG.value, obsB.value))
                    (addListener)(r => hex.innerText                     = toHexString(r, obsG.value, obsB.value))



    const obsG = InitObservable
                    (addListener)(g => obsG.value                        = g )
                    (addListener)(g => inputG.value                      = g )
                    (addListener)(g => rangeG.value                      = g )
                    (addListener)(g => resultColor.style.backgroundColor = toRGBString(obsR.value, g, obsB.value))
                    (addListener)(g => rgbValue.value                    = toRGBString(obsR.value, g, obsB.value))
                    (addListener)(g => hex.innerText                     = toHexString(obsR.value, g, obsB.value))


    const obsB = InitObservable
                    (addListener)(b => obsB.value                        = b )
                    (addListener)(b => inputB.value                      = b )
                    (addListener)(b => rangeB.value                      = b )
                    (addListener)(b => resultColor.style.backgroundColor = toRGBString(obsR.value, obsG.value, b))
                    (addListener)(b => rgbValue.value                    = toRGBString(obsR.value, obsG.value, b))
                    (addListener)(b => hex.innerText                     = toHexString(obsR.value, obsG.value, b))



    onInputListeners(obsR, inputR, rangeR)
    onInputListeners(obsG, inputG, rangeG)
    onInputListeners(obsB, inputB, rangeB)



    const setObservablesValue = (...observables) => value =>
        observables.forEach(obs => obs(setValue)(value))


    setObservablesValue(obsR, obsG, obsB)(42)


    let testObsVariabel = ""
    console.log("testObsVariabel :" + testObsVariabel)



    const logHandler = nVal => oVal => console.log(nVal, oVal)
    const handlerPair1 = pair(1)(logHandler)
    const handlerPair2 = pair(22)(logHandler)
    const handlerPair3 = pair(44)(logHandler)
    const handlerPair4 = pair(45)(logHandler)

    let testObs = InitObsverableVal(null)
                        (addListenerVal)(handlerPair1)
                        (addListenerVal)(handlerPair2)
                        (addListenerVal)(handlerPair3)
                        (addListenerVal)(handlerPair4)
                        // (addListenerVal)(valueHandler)

    // testObs = testObs(setValueVal)("000")

    // testObs(removeListenerVal)(logHandler)

    const changeValue = () =>{

    }

</script>
<hr>


</body>
</html>
